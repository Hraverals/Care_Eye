# Care-Eye (케어-아이) : 낙상 감지 시스템 (Fall Detection System using MediaPipe Pose)
> **충남대학교 어드벤처디자인 (표고와 박셋의 어드벤처 타임) 프로젝트**  
> “혼자 있는 노인의 낙상 사고를 신속하게 감지하고 보호자에게 알릴 수 있는 시스템 설계”

---

## 프로젝트 개요

고령의 1인 가구 노인은 낙상 사고 발생 시 즉각적인 대응이 어려워 **생명에 위협이 될 수 있습니다.**  
저희 팀은 **카메라 기반 자세 인식 기술(MediaPipe Pose)** 을 활용하여  
**낙상 발생을 실시간으로 감지하고**, 일정 시간 이상 지속 시 **응급 경보를 발생**시키는 시스템을 구현했습니다.  

---

## 문제 정의

고령의 1인 가구 노인에게 낙상 사고가 발생했을 때,  
실시간으로 상황을 인식하고 보호자가 신속히 대응하기 어렵다. 

---

## 해결 방안 (Solution)

**MediaPipe Pose 기반 실시간 낙상 감지 프로그램**  
- 개인 영상 데이터 외부 전송 없이 로컬에서만 동작  
- 자세 기울기 분석으로 낙상 판별  
- 낙상 상태가 일정 시간 지속될 경우 응급 상태(Emergency)로 전환  
- 시각적 피드백(플래싱 효과, 시간 카운트)을 통해 사용자에게 즉시 알림

---

## 주요 기능

- ✅ **몸통 기울기 기반 낙상 감지**
  - 어깨–엉덩이 벡터가 수직선 대비 35° 이상 기울면 “낙상”으로 판정
- ✅ **지속 시간 기반 판단**
  - 순간적인 움직임이 아닌, 5초 이상 조건 유지 시 낙상 확정
- ✅ **플래싱 & 경과시간 표시**
  - 붉은색 반투명 마스크를 0.5초 간격으로 점멸하며 시각적 경고 표시
  - 낙상 지속 시간(초 단위) 실시간 표시
- ✅ **낙상 상태 30초 이상 지속 시 `EMERGENCY` 상태로 전환**
  - `Fall Suspected` -> `Fall Detection` -> `EMERGENCY` 순서로 상태 변화
- ✅ **Tracking Lost/Classification Flip 복원**
  - 일시적 인식 끊김이나 자세 오판정에도 낙상 시간 카운트 유지
- ✅ **낙상 사고 영상 기록 기능**
  - 낙상 감지 시 즉시 영상 녹화를 시작하여, 사고 발생 전후의 화면을 자동 저장
- ✅ **안전 구역 설정 기능**
  - 마우스 포인트 지정 기반 영역 생성
  - 소파, 침대 등 낙상으로 오인될 수 있는 영역을 사용자 정의로 설정 가능
  - 설정된 안전 구역 내에서는 낙상 판정을 제외하여 오탐을 최소화

---

## 실행 파일별 기능
- **Care_Eye.py**
  - MediaPipe Pose 기반의 실시간 낙상 감지 시스템을 수행합니다. 
    사용자의 자세 변화를 분석하여 낙상 의심·확정·응급 상태를 단계적으로 판별하고, 시각적 경고(플래싱, 타이머)를 제공합니다. 
    낙상 발생 시점 전후 약 30초의 영상을 자동으로 녹화·저장하는 블랙박스 기능을 포함합니다. 
    safe_zones.json에 등록된 안전 구역 정보를 불러와, 지정된 영역 내에서는 낙상 감지를 제외합니다. 

- **Safe_Zone_Creator.py**
  - 카메라 영상 위에서 마우스로 다각형을 그려 안전 구역(Safe Zone) 을 설정할 수 있는 인터페이스를 제공합니다. 
    생성된 영역은 정규화 좌표로 변환되어 safe_zones.json 파일에 저장되며, Care_Eye.py 실행 시 자동으로 불러와 적용됩니다. 
    단축키를 이용해 구역 추가(Z, F), 되돌리기(X, U), 저장(S), 초기화(C) 등을 직관적으로 제어할 수 있습니다. 

---

## 시스템 구성

- **언어**: Python 3.10 환경
- **라이브러리**
  ```bash
  pip install -r requirements.txt
